version: "3"

services:
  sup-discovery:
    image: mss-discovery
    build:
      context: ./infrastructure
      dockerfile: mss-discovery
    ports:
      - 8761:8761
    healthcheck:
      test: ["CMD", "curl", "-f", "http://sup-discovery:8761"]
      interval: 30s
      timeout: 3s
      retries: 10

#Configuration centralize
  sup-config:
    image: mss-config
    build:
      context: ./infrastructure
      dockerfile: mss-config
    ports:
      - 8888:8888
    depends_on:
      - sup-discovery

#Authentication/Authorization
  sup-auth:
    image: mss-auth
    build:
      context: ./infrastructure
      dockerfile: mss-auth
    ports:
      - 9999:9999
    depends_on:
    - sup-discovery
    - sup-config

# Edge server
  sup-edge:
    image: mss-edge
    build:
      context: ./infrastructure
      dockerfile: mss-edge
    ports:
      - 8765:8765
    depends_on:
    - sup-discovery
    - sup-config
#Monitor DashBoard
  sup-monitor-dashboard:
    image: mss-hystrix
    build:
      context: ./infrastructure
      dockerfile: mss-hystrix
    ports:
      - 7979:7979
    depends_on:
    - sup-discovery
    - sup-turbine
    - sup-config

#Turbine Stream
  sup-turbine:
    image: mss-turbine
    build:
      context: ./infrastructure
      dockerfile: mss-turbine
    ports:
      - 8989:8989
    depends_on:
    - sup-config